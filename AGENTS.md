# gem-code Project

## Project Overview

gem-code is a lightweight CLI Agent that provides an interactive chat interface with AI models (specifically MiniMax-M2.5 by default). It uses the OpenAI-compatible API format to communicate with AI services and supports streaming responses with reasoning content separation.

## Technology Stack

- **Language**: Python 3.12+
- **Package Manager**: [uv](https://docs.astral.sh/uv/) (modern Python package manager)
- **Key Dependencies**:
  - `openai>=2.21.0` - OpenAI API client for chat completions
  - `rich>=14.3.3` - Terminal formatting and console output
  - `pytest>=9.0.2` - Testing framework

## Project Structure

```
gem-code/
├── main.py                    # Entry point (minimal, prints greeting)
├── pyproject.toml             # Project configuration and dependencies
├── uv.lock                    # Locked dependency versions (generated by uv)
├── .python-version            # Specifies Python 3.12
├── .env_example               # Example environment variables file
├── test_openai_response_api.py # Test/demo script for streaming API
├── README.md                  # Project readme (currently empty)
└── src/                       # Source code modules
    ├── cli.py                 # CLI interface (incomplete - 7 lines)
    ├── config.py              # Configuration management and system prompts
    ├── session.py             # Chat session handling with streaming
    └── tool.py                # Tool calling infrastructure (currently empty)
```

## Configuration

The application uses environment variables for configuration:

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `OPENAI_API_KEY` | Yes | - | API key for the AI service |
| `OPENAI_BASE_URL` | Yes | - | Base URL for the API endpoint |
| `OPENAI_MODEL` | No | `MiniMax-M2.5` | Model name to use |
| `WORKDIR` | No | Current directory | Working directory for the agent |

Copy `.env_example` to `.env` and fill in your values.

### Configuration Example (.env_example)

```bash
OPENAI_API_KEY=sk-...
OPENAI_BASE_URL=https://api.minimaxi.com/v1
OPENAI_MODEL=MiniMax-M2.5
WORKDIR=/gem_code
```

## Build and Run Commands

This project uses `uv` for dependency management and running:

```bash
# Install dependencies
uv sync

# Run the project
uv run python main.py

# Run tests
uv run pytest

# Run the test/demo script
uv run python test_openai_response_api.py
```

## Code Organization

### Core Modules

1. **config.py** - Configuration and data models
   - `Config` dataclass: stores API credentials and settings
   - `load_config()`: loads configuration from environment variables
   - `Message` dataclass: chat message structure
   - `ToolCall` dataclass: tool calling data structure
   - `get_system_prompt()`: returns system prompt with current workdir
   - `createOpenAIClient()`: factory for OpenAI client instances

2. **session.py** - Chat session management
   - `Session` class: manages conversation history and API communication
   - `chat()`: handles streaming chat with reasoning content separation
   - Uses rich console for formatted output

3. **cli.py** - Command-line interface (currently minimal/incomplete)

4. **tool.py** - Tool calling infrastructure (currently empty)

### Key Features

- **Streaming Responses**: Real-time streaming of AI responses
- **Reasoning Split**: Uses `reasoning_split=True` to separate thinking content from final answers
- **Tool Calling Support**: Infrastructure for bash commands and file reading (partially implemented)
- **Rich Console Output**: Colored and formatted terminal output

## Testing

The project includes a test/demo script `test_openai_response_api.py` that:
- Demonstrates streaming API usage with MiniMax-M2.5
- Shows reasoning content separation
- Tests the complete flow from request to response

Run with: `uv run python test_openai_response_api.py`

## Code Style Guidelines

- Follow PEP8 naming conventions
- Use type hints throughout
- Use dataclasses for data structures
- Prefer `snake_case` for functions and variables
- Comments in Chinese are present in the codebase

## Security Considerations

⚠️ **Important**: The test files and `.env_example` contain hardcoded API keys. These should:
- Never be committed to version control
- Be rotated immediately if exposed
- Be moved to proper secret management for production

The `load_config()` function validates that required environment variables are set and raises `ValueError` if missing.

## Development Notes

- The project is currently in early development (version 0.1.0)
- The `tool.py` and `cli.py` modules are incomplete
- The `tool.py` module is intended to implement bash tool and read_file tool capabilities as described in the system prompt
- Session management maintains conversation history in memory
